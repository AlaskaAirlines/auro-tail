@use 'sass:string';
@use 'sass:map';
@use 'sass:list';

/* Constants */
$tail-sizes: (xs, sm, md, lg, xl, 2xl);
$tail-sizes-with-badge: (md, lg, xl, 2xl);
$tail-sizes-with-href: (md, lg, xl, 2xl);
$tail-group-sizes: (xs, sm, md, lg);
$tail-variants: (as, ha, oa);

/* Size Maps */
$avatar-width: (
  'xs': 24px,
  'sm': 32px,
  'md': 48px,
  'lg': 60px,
  'xl': 96px,
  '2xl': 134px
);

$tail-width: (
  'xs': 19px,
  'sm': 26px,
  'md': 39px,
  'lg': 48px,
  'xl': 77px,
  '2xl': 107px
);

/* Adjust vertical offset to visually center tail icon within circular avatar */
$tail-offset-y: (
  'xs': 3px,
  'sm': 4px,
  'md': 6px,
  'lg': 7px,
  'xl': 13px,
  '2xl': 17px
);

$href-label-gap: (
  'md': 2px,
  'lg': 4px,
  'xl': 6px,
  '2xl': 8px
);

$badge-width: (
  'md': 11px,
  'lg': 14px,
  'xl': 22px,
  '2xl': 31px
);

$group-diagonal-width: (
  'xs': 42px,
  'sm': 56px,
  'md': 84px,
  'lg': 105px
);

/* Group - Horizontal Map */
$group-horizontal: (
  'lg': (border-width: 4px, overlap: -10px),
  'md': (border-width: 4px, overlap: -6px),
  'sm': (border-width: 3px, overlap: -2px),
  'xs': (border-width: 3px, overlap: -2px)
);

/* Token Definitions */
:host {
  /* Host dimensions to match container */
  width: var(--avatar-width);
  height: var(--avatar-width);
  min-width: var(--avatar-width);
  
  /* Default Values */
  --avatar-width: var(--avatar-width-lg);
  --avatar-gradient: var(--gradient-oa);
  --tail-width: var(--tail-width-lg);
  --tail-offset-y: var(--tail-offset-y-lg);
  --href-label-gap: var(--href-label-gap-lg);
  --badge-width: var(--badge-width-lg);
  
  /* Border defaults */
  --border-color-default: rgba(88, 94, 103, 1);
  --border-color-white: #ffffff;
  --border-width-default: 4px;
  --border-display: none;
  --border-padding: 0;
  --border-radius-full: 999px;

  /* Tail outline defaults */
  --tail-outline-color: var(--border-color-default);
  --tail-outline-width: 1px;

  /* Avatar Gradients */
  --gradient-as: linear-gradient(180deg, #6899C6 0%, #CFE0EF 100%);
  --gradient-ha: linear-gradient(181deg, #CCB7ED -6.38%, #F9C2E7 99.46%);
  --gradient-oa: linear-gradient(181deg, #C5D0D9 -6.38%, #E8F1F8 99.46%);

  /* Drop Shadow */
  --tail-drop-shadow: drop-shadow(0 3px 3px rgba(0,0,0,.24)) drop-shadow(0 6px 14px rgba(0,0,0,.24));

  /* Tail default z-index */
  --z-index-border: 1;
  --z-index-badge: 2;
  
  /* Group z-index */
  --z-index-group-back: 1;
  --z-index-group-front: 2;

  /* Badge transform defaults */
  --badge-translate-x: 0;
  --badge-translate-y: 0;

  /* Generate Tail size-based tokens */
  @each $property, $map in (
    'avatar-width': $avatar-width,
    'tail-width': $tail-width,
    'tail-offset-y': $tail-offset-y,
    'href-label-gap': $href-label-gap,
    'badge-width': $badge-width
  ) {
    @each $tailSize, $value in $map {
      --#{$property}-#{$tailSize}: #{$value};
    }
  }

  /* Generate Group - Diagonal tokens */
  @each $groupSize, $value in $group-diagonal-width {
    --group-diagonal-width-#{$groupSize}: #{$value};
  }

  /* Generate Group - Horizontal tokens */
  @each $size in $tail-group-sizes {
    --group-horizontal-border-width-#{$size}: #{map.get(map.get($group-horizontal, $size), border-width)};
    --group-horizontal-overlap-#{$size}: #{map.get(map.get($group-horizontal, $size), overlap)};
  }
}

/* Apply tokens to tail sizes */
@each $size in $tail-sizes {
  :host([size="#{$size}"]) {
    --avatar-width: var(--avatar-width-#{$size});
    --tail-width: var(--tail-width-#{$size});
    --tail-offset-y: var(--tail-offset-y-#{$size});
    
    @if list.index($tail-sizes-with-badge, $size) {
      --badge-width: var(--badge-width-#{$size});
    }
    
    @if list.index($tail-sizes-with-href, $size) {
      --href-label-gap: var(--href-label-gap-#{$size});
    }
    
    /* Badge transform overrides */
    @if $size == 'md' {
      --badge-translate-x: 2px;
      --badge-translate-y: -7px;
    }
    
    @if $size == 'lg' {
      --badge-translate-x: 2px;
      --badge-translate-y: -4px;
    }
  }
}

/* Apply gradients to variants */
/* Support lowercase and uppercase attribute values */
@each $variant in $tail-variants {
  :host([tail="#{$variant}"]),
  :host([tail="#{string.to-upper-case($variant)}"]) {
    --avatar-gradient: var(--gradient-#{$variant});
  }
}
