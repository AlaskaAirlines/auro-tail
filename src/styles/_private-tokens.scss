@use 'sass:map';

/* Size config */
$sizes: (
  'xs': (container-w: 24px, tail-w: 19px, tail-offset-y: 3px),
  'sm': (container-w: 32px, tail-w: 26px, tail-offset-y: 4px),
  'md': (container-w: 48px, tail-w: 39px, tail-offset-y: 6px, href-label-gap: 2px, badge-w: 11px, badge-offset-x: 2px, badge-offset-y: -7px),
  'lg': (container-w: 60px, tail-w: 48px, tail-offset-y: 7px, href-label-gap: 4px, badge-w: 14px, badge-offset-x: 2px, badge-offset-y: -4px),
  'xl': (container-w: 96px, tail-w: 77px, tail-offset-y: 13px, href-label-gap: 6px, badge-w: 22px),
  '2xl': (container-w: 134px, tail-w: 107px, tail-offset-y: 17px, href-label-gap: 8px, badge-w: 31px)
);

/* Group config */
$groups: (
  'xs': (group-diag-w: 42px, group-horiz-border-w: 3px, group-horiz-overlap: -2px),
  'sm': (group-diag-w: 56px, group-horiz-border-w: 3px, group-horiz-overlap: -2px),
  'md': (group-diag-w: 84px, group-horiz-border-w: 4px, group-horiz-overlap: -6px),
  'lg': (group-diag-w: 105px, group-horiz-border-w: 4px, group-horiz-overlap: -10px)
);

/* Carrier gradients */
$gradients: (
  'as': linear-gradient(180deg, #6899C6 0%, #CFE0EF 100%),
  'ha': linear-gradient(181deg, #CCB7ED -6.38%, #F9C2E7 99.46%),
  'oa': linear-gradient(181deg, #C5D0D9 -6.38%, #E8F1F8 99.46%)
);

:host {
  display: inline-block;
  width: var(--ds-auro-tail-container-w);
  height: var(--ds-auro-tail-container-w);
  min-width: var(--ds-auro-tail-container-w);
  min-height: var(--ds-auro-tail-container-w);

  /* Defaults (lg size + oa carrier type) */
  --ds-auro-tail-container-w: var(--ds-auro-tail-container-w-lg);
  --ds-auro-tail-container-gradient: var(--ds-auro-tail-gradient-oa);
  --ds-auro-tail-tail-w: var(--ds-auro-tail-tail-w-lg);
  --ds-auro-tail-tail-offset-y: var(--ds-auro-tail-tail-offset-y-lg);
  --ds-auro-tail-href-label-gap: var(--ds-auro-tail-href-label-gap-lg);
  --ds-auro-tail-badge-w: var(--ds-auro-tail-badge-w-lg);

  /* Border */
  /* Color values are theme-independent */
  --ds-auro-tail-border-color-default: rgba(88, 94, 103, 1);
  --ds-auro-tail-border-color-white: #ffffff;
  --ds-auro-tail-border-w-default: 0;
  --ds-auro-tail-border-display: none;
  --ds-auro-tail-border-padding: 0;
  --ds-auro-tail-border-radius-full: 999px;

  /* Tail outline */
  --ds-auro-tail-tail-outline-color: var(--ds-auro-tail-border-color-default);
  --ds-auro-tail-tail-outline-w: 1px;

  /* Shadows & z-index */
  --ds-auro-tail-tail-drop-shadow: drop-shadow(0 3px 3px rgba(0,0,0,.24)) drop-shadow(0 6px 14px rgba(0,0,0,.24));
  --ds-auro-tail-z-index-border: 1;
  --ds-auro-tail-z-index-badge: 2;
  --ds-auro-tail-z-index-group-back: 1;
  --ds-auro-tail-z-index-group-front: 2;

  /* Badge offset defaults */
  --ds-auro-tail-badge-offset-x: 0;
  --ds-auro-tail-badge-offset-y: 0;

  /* Generate size tokens */
  @each $size, $props in $sizes {
    @each $prop, $value in $props {
      --ds-auro-tail-#{$prop}-#{$size}: #{$value};
    }
  }

  /* Generate group tokens */
  @each $size, $props in $groups {
    @each $prop, $value in $props {
      --ds-auro-tail-#{$prop}-#{$size}: #{$value};
    }
  }

  /* Generate gradient tokens */
  @each $tail, $gradient in $gradients {
    --ds-auro-tail-gradient-#{$tail}: #{$gradient};
  }
}

/* Apply size-specific tokens */
@each $size, $props in $sizes {
  :host([size="#{$size}"]) {
    --ds-auro-tail-container-w: var(--ds-auro-tail-container-w-#{$size});
    --ds-auro-tail-tail-w: var(--ds-auro-tail-tail-w-#{$size});
    --ds-auro-tail-tail-offset-y: var(--ds-auro-tail-tail-offset-y-#{$size});

    @if map.has-key($props, badge-w) {
      --ds-auro-tail-badge-w: var(--ds-auro-tail-badge-w-#{$size});
      --ds-auro-tail-badge-offset-x: var(--ds-auro-tail-badge-offset-x-#{$size}, 0);
      --ds-auro-tail-badge-offset-y: var(--ds-auro-tail-badge-offset-y-#{$size}, 0);
    }
    @if map.has-key($props, href-label-gap) {
      --ds-auro-tail-href-label-gap: var(--ds-auro-tail-href-label-gap-#{$size});
    }
  }
}

/* Apply tail gradients (case-insensitive) */
@each $tail, $gradient in $gradients {
  :host([tail="#{$tail}" i]) {
    --ds-auro-tail-container-gradient: var(--ds-auro-tail-gradient-#{$tail});
  }
}
